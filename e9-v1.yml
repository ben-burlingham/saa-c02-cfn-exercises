Parameters: 
  UniqueSuffix: 
    AllowedPattern: ^[\d\w]{5,}$
    Type: String
    Description: Suffixed identifier to provide uniqueness on all names

Resources: 
  #===== S3
  HelloBucketEncrypted: 
    Type: AWS::S3::Bucket
    Properties: 
      BucketName: !Sub 'hello-bucket-encrypted-${UniqueSuffix}'
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: 'aws:kms'
              KMSMasterKeyID: !GetAtt HelloKmsKey.Arn
  
  HelloBucketUnencrypted: 
    Type: AWS::S3::Bucket
    Properties: 
      BucketName: !Sub 'hello-bucket-unencrypted-${UniqueSuffix}'
  
  #===== KMS
  HelloKmsKey: 
    Type: AWS::KMS::Key
    Properties: 
      KeyPolicy: 
        Statement:
          - Sid: 'Allow access for Key Administrators'
            Effect: 'Allow'
            Principal: 
              AWS: !Sub arn:aws:iam::${AWS::AccountId}:root
            Action: 
              - 'kms:Create*'
              - 'kms:Describe*'
              - 'kms:Enable*'
              - 'kms:List*'
              - 'kms:Put*'
              - 'kms:Update*'
              - 'kms:Revoke*'
              - 'kms:Disable*'
              - 'kms:Get*'
              - 'kms:Delete*'
              - 'kms:ScheduleKeyDeletion'
              - 'kms:CancelKeyDeletion'
            Resource: '*'
      Tags: 
        - Key: 'Name'
          Value: 'Hello Kms Key'

