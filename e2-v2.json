{
    "Resources": {
      "HelloBucket": {
        "Type": "AWS::S3::Bucket",
        "Properties": {
          "AccessControl": "Private",
          "BucketEncryption": {
            "ServerSideEncryptionConfiguration": [
              {
                "ServerSideEncryptionByDefault": {
                  "SSEAlgorithm": "AES256"
                }
              }
            ]
          },
          "BucketName": { "Fn::Sub": [
            "hello-bucket-${Suffix}",
            {"Suffix": { "Ref": "UniqueSuffix" }}
          ]}
        }
      },
      "HelloBucketPolicy": {
        "Type": "AWS::S3::BucketPolicy",
        "Properties": {
          "Bucket": { "Ref": "HelloBucket" },
          "PolicyDocument": {
            "Statement": {
              "Principal": "*",
              "Action": "*",
              "Effect": "Allow",
              "Resource": {
                "Fn::Sub": [
                  "arn:aws:s3:::${TargetBucketName}/*",
                  {"TargetBucketName": { "Ref": "HelloBucket" }}
                ]
              }
            }
          }
        }
      }
    },
    "Parameters": {
      "UniqueSuffix": {
        "AllowedPattern": "^[\\d\\w]{5,}$",
        "Type": "String",
        "Description": "Suffixed identifier to provide uniqueness on all names"
      }
    },
    "Outputs" : {
      "HelloBucketArn": {
        "Description": "HelloBucket ARN",
        "Value": { "Fn::GetAtt": [ "HelloBucket", "Arn" ] }
      }
    }
}
